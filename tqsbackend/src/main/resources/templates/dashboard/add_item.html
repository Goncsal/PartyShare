<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Add New Item - PartyShare</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: bold;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 1em;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 10px;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-secondary {
            background-color: #95a5a6;
            color: white;
            text-decoration: none;
            display: block;
            text-align: center;
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            text-decoration: none;
            color: #3498db;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .error {
            color: #e74c3c;
            background-color: #fadbd8;
            padding: 10px;
            border-radius: 3px;
            margin-bottom: 15px;
        }

        .success {
            color: #27ae60;
            background-color: #d5f4e6;
            padding: 10px;
            border-radius: 3px;
            margin-bottom: 15px;
        }
    </style>
</head>

<body>
    <a href="/owner/dashboard" class="back-link">← Back to Dashboard</a>

    <h1>Add New Rental Item</h1>

    <div id="message"></div>

    <form id="addItemForm">
        <div class="form-group">
            <label for="name">Item Name *</label>
            <input type="text" id="name" name="name" required>
        </div>

        <div class="form-group">
            <label for="description">Description *</label>
            <textarea id="description" name="description" required></textarea>
        </div>

        <div class="form-group">
            <label for="price">Price (€/day) *</label>
            <input type="number" id="price" name="price" step="0.01" min="0" required>
        </div>

        <div class="form-group">
            <label for="location">Location *</label>
            <input type="text" id="location" name="location" required>
        </div>

        <div class="form-group">
            <label for="category">Category *</label>
            <select id="category" name="category" required>
                <option value="">Select a category</option>
            </select>
        </div>

        <button type="submit" class="btn btn-primary">Add Item</button>
        <a href="/owner/dashboard" class="btn btn-secondary">Cancel</a>
    </form>

    <script>
        // Load categories
        fetch('/api/categories')
            .then(response => response.json())
            .then(categories => {
                const select = document.getElementById('category');
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.id;
                    option.textContent = cat.name;
                    select.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error loading categories:', error);
            });

        // Handle form submission
        document.getElementById('addItemForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const formData = {
                name: document.getElementById('name').value,
                description: document.getElementById('description').value,
                price: parseFloat(document.getElementById('price').value),
                location: document.getElementById('location').value,
                category: {
                    id: parseInt(document.getElementById('category').value)
                }
            };

            fetch('/api/owner/dashboard/items', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
                .then(response => {
                    if (response.ok) {
                        showMessage('Item added successfully! Redirecting...', 'success');
                        setTimeout(() => {
                            window.location.href = '/owner/dashboard';
                        }, 1500);
                    } else {
                        return response.json().then(data => {
                            throw new Error(data.error || 'Failed to add item');
                        });
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showMessage('Error: ' + error.message, 'error');
                });
        });

        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = type;
        }
    </script>
</body>

</html>