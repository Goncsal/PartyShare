<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Booking Requests - PartyShare</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <div>
                <h1><i class="fas fa-envelope-open-text"></i> Booking Requests</h1>
                <p>Manage incoming requests for your items</p>
            </div>
            <div class="actions">
                <a href="/items/search" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Back to Search</a>
            </div>
        </div>

        <div th:if="${bookings.empty}"
            style="padding: 40px; text-align: center; color: #95a5a6; background: white; border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);">
            <p>No pending requests.</p>
        </div>

        <div th:if="${!bookings.empty}">
            <div class="card" th:each="booking : ${bookings}" style="margin-bottom: 20px;">
                <h3 th:text="${booking.item.name}" style="margin-top: 0; color: #2c3e50;">Item Name</h3>
                <div style="color: #555; line-height: 1.6;">
                    <p><strong><i class="fas fa-user"></i> Renter ID:</strong> <span
                            th:text="${booking.renterId}">123</span></p>
                    <p><strong><i class="fas fa-calendar-alt"></i> Dates:</strong> <span
                            th:text="${booking.startDate}">Start</span> to <span th:text="${booking.endDate}">End</span>
                    </p>
                    <p><strong><i class="fas fa-tag"></i> Total Price:</strong> <span
                            style="font-weight: bold; color: #d35400;">€<span
                                th:text="${booking.totalPrice}">100.00</span></span>
                        <span th:if="${booking.status.toString() == 'COUNTER_OFFER'}"
                            style="color: #e67e22; font-weight: bold; margin-left: 10px;">(Counter Offer Sent)</span>
                    </p>
                </div>

                <div class="actions"
                    style="margin-top: 20px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <form th:action="@{/bookings/{id}/accept(id=${booking.id})}" method="post" style="display:inline;">
                        <button type="submit" class="btn btn-primary" style="background-color: #27ae60;">Accept</button>
                    </form>

                    <form th:action="@{/bookings/{id}/decline(id=${booking.id})}" method="post" style="display:inline;">
                        <button type="submit" class="btn btn-secondary"
                            style="background-color: #e74c3c; color: white;">Decline</button>
                    </form>

                    <button type="button" class="btn btn-secondary" onclick="toggleCounterOffer(this)"
                        th:data-target="'counterOffer-' + ${booking.id}"
                        style="background-color: #f39c12; color: white;">
                        Counter Offer
                    </button>
                </div>

                <div th:id="'counterOffer-' + ${booking.id}"
                    style="display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                    <form th:action="@{/bookings/{id}/counter-offer(id=${booking.id})}" method="post">
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="number" step="0.01" name="price" placeholder="New Daily Price (€)" required
                                class="form-control" style="max-width: 200px;">
                            <button type="submit" class="btn btn-primary">Send Offer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleCounterOffer(btn) {
            const targetId = btn.getAttribute('data-target');
            const target = document.getElementById(targetId);
            if (target.style.display === 'none') {
                target.style.display = 'block';
            } else {
                target.style.display = 'none';
            }
        }
    </script>
</body>

</html>