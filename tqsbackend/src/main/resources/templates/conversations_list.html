<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>My Conversations</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 20px;
            background: #f7f9fb;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 0.95em;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #3498db;
            text-decoration: none;
            font-size: 0.95em;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .conversations-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .conversation-item {
            padding: 20px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .conversation-item:last-child {
            border-bottom: none;
        }

        .conversation-item:hover {
            background: #f8f9fa;
        }

        .conversation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .conversation-user {
            font-weight: 600;
            font-size: 1.1em;
            color: #2c3e50;
        }

        .conversation-time {
            font-size: 0.85em;
            color: #95a5a6;
        }

        .conversation-preview {
            color: #555;
            line-height: 1.5;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .message-prefix {
            font-weight: 500;
            color: #7f8c8d;
        }

        .message-text {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
        }

        .no-conversations {
            padding: 60px 20px;
            text-align: center;
        }

        .no-conversations-icon {
            font-size: 4em;
            color: #bdc3c7;
            margin-bottom: 15px;
        }

        .no-conversations-title {
            font-size: 1.3em;
            color: #7f8c8d;
            margin-bottom: 10px;
        }

        .no-conversations-text {
            color: #95a5a6;
            margin-bottom: 20px;
        }

        .browse-items-btn {
            display: inline-block;
            padding: 12px 24px;
            background: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            transition: background-color 0.2s;
        }

        .browse-items-btn:hover {
            background: #2980b9;
        }

        .item-badge {
            display: inline-block;
            padding: 3px 8px;
            background: #e8f4f8;
            color: #3498db;
            border-radius: 4px;
            font-size: 0.8em;
            margin-left: 8px;
        }
    </style>
</head>

<body>
    <div class="container">
        <a href="/items/search" class="back-link">&larr; Back to Search</a>
        <h1>My Conversations</h1>
        <p class="subtitle">View and reply to your messages with other users</p>

        <div th:if="${conversations != null and !conversations.empty}" class="conversations-container">
            <a th:each="conv : ${conversations}"
                th:href="@{/messages/new(receiverId=${conv.otherUserId}, itemId=${conv.itemId})}"
                class="conversation-item">
                <div class="conversation-header">
                    <span class="conversation-user" th:text="${conv.otherUserName}">User Name</span>
                    <span class="conversation-time"
                        th:text="${#temporals.format(conv.lastMessageTime, 'dd/MM/yyyy HH:mm')}">Time</span>
                </div>
                <div class="conversation-preview">
                    <span class="message-prefix" th:text="${conv.lastMessageFromMe} ? 'You:' : ''"></span>
                    <span class="message-text" th:text="${conv.lastMessageContent}">Message preview</span>
                    <span th:if="${conv.itemId != null}" class="item-badge">Item Inquiry</span>
                </div>
            </a>
        </div>

        <div th:if="${conversations == null or conversations.empty}" class="conversations-container">
            <div class="no-conversations">
                <div class="no-conversations-icon">ðŸ’¬</div>
                <div class="no-conversations-title">No conversations yet</div>

                <!-- Message for RENTER -->
                <div th:if="${userRole != null and userRole.toString() == 'RENTER'}">
                    <p class="no-conversations-text">
                        Start a conversation by sending a message to an item owner!<br>
                        Browse items and click "Contact Owner" to begin.
                    </p>
                    <a href="/items/search" class="browse-items-btn">Browse Items</a>
                </div>

                <!-- Message for OWNER -->
                <div th:if="${userRole != null and userRole.toString() == 'OWNER'}">
                    <p class="no-conversations-text">
                        You don't have any conversations with renters yet.<br>
                        When someone messages you about your items, they'll appear here.
                    </p>
                    <a href="/owner/dashboard" class="browse-items-btn">Go to Dashboard</a>
                </div>

                <!-- Fallback message -->
                <div th:if="${userRole == null}">
                    <p class="no-conversations-text">
                        Start a conversation by sending a message to an item owner!
                    </p>
                    <a href="/items/search" class="browse-items-btn">Browse Items</a>
                </div>
            </div>
        </div>
    </div>
</body>

</html>